# CallAcceptEngine 사람 기준 비유 모델

**작성일:** 2026-01-04
**목적:** 기술 용어 없이 일상적 비유로 시스템 이해하기

---

## 1. 전체 시스템: "자동 콜 수락 공장"

### 1.1 공장 개요

**당신은 택시 기사입니다.**
하지만 매번 손으로 콜을 확인하고 클릭하기 귀찮아서,
**"자동 콜 수락 로봇(엔진)"**을 고용했습니다.

**로봇의 임무:**
1. 카카오T 앱 화면을 계속 지켜보기
2. 조건에 맞는 콜이 뜨면 자동으로 클릭하기
3. 확인 버튼까지 눌러서 최종 수락하기

---

## 2. 등장인물 (시스템 구성요소)

### 2.1 엔진 (Engine) = "공장 관리자"

**역할:**
- 작업 스케줄 관리
- 전문가(핸들러)들에게 일 배분
- 상황 기록 및 보고

**하는 일:**
```
7시 00분: "지금부터 일 시작이야!"
7시 00분: "콜 리스트 전문가야, 화면 좀 봐봐"
7시 01분: "수락 버튼 전문가야, 이제 네 차례야"
```

**하면 안 되는 일:**
- ❌ 직접 화면에서 버튼 찾기
- ❌ 금액이 얼마인지 판단하기
- ❌ "이 콜 괜찮은가?"라고 고민하기

---

### 2.2 핸들러 (Handler) = "전문가 팀"

**종류별 전문가:**

| 전문가 이름 | 담당 업무 | 비유 |
|-----------|---------|-----|
| `IdleHandler` | 휴식 상태 관리 | "오늘 쉬는 날" 팀장 |
| `CallListHandler` | 콜 리스트에서 조건 맞는 콜 찾기 | "스카우터" (조건 맞는 콜 탐색) |
| `DetectedCallHandler` | 수락 버튼 누르기 | "1단계 클릭 담당" |
| `WaitingForConfirmHandler` | 확인 버튼 누르기 | "2단계 확인 담당" |

**전문가의 특징:**
- 각자 한 가지 일만 잘함
- 관리자가 "네 차례야!" 하면 일하고, 아니면 대기
- 일이 끝나면 관리자에게 보고: "성공했어요" 또는 "실패했어요"

---

### 2.3 상태 (State) = "공장 상태판"

**공장 입구의 큰 전광판:**
```
┌──────────────────────────┐
│  현재 상태: 콜 대기 중     │
│  (WAITING_FOR_CALL)      │
└──────────────────────────┘
```

**가능한 상태들:**
1. **IDLE (휴식 중):** "오늘은 쉬는 날이야"
2. **WAITING_FOR_CALL (콜 대기 중):** "화면 보면서 좋은 콜 찾는 중"
3. **DETECTED_CALL (콜 발견!):** "좋은 콜 찾았어! 지금 클릭할게"
4. **WAITING_FOR_CONFIRM (확인 기다림):** "수락 버튼 눌렀는데 확인창 뜨기 기다리는 중"
5. **CALL_ACCEPTED (성공!):** "완료! 콜 잡았다!"
6. **ERROR_TIMEOUT (시간 초과):** "너무 오래 걸려서 포기..."
7. **ERROR_ASSIGNED (이미 배차됨):** "아, 다른 기사가 먼저 가져갔네"

---

## 3. 상태별 비유 (일상 시나리오)

### 상태 1: IDLE (휴식)
```
상황: 당신이 "오늘은 쉬고 싶어" 버튼 누름
로봇: (전원 꺼짐 상태) 💤
관리자: "알겠습니다. 모두 퇴근!"
```

**허용되는 행동:**
- ✅ 가만히 있기

**절대 하면 안 되는 행동:**
- ❌ 화면 보기
- ❌ 버튼 클릭

---

### 상태 2: WAITING_FOR_CALL (콜 대기)
```
상황: "시작" 버튼 누름 → 로봇 작동 시작

관리자: "좋아, 이제부터 콜 리스트 화면 계속 확인해!"
        "5초마다 새로고침 버튼도 눌러줘!"

스카우터(CallListHandler):
    [화면 보는 중...]
    "음... 금액 15,000원, 도착지 인천공항... 조건 맞네!"
    [콜 아이템 클릭!]

관리자: "좋아! 상태 변경: DETECTED_CALL로!"
```

**비유:**
- 당신이 쇼핑몰 앞에 서서 "좋은 물건 나올 때까지 기다리는 중"
- 5초마다 "상품 목록 새로고침" 버튼 클릭
- 마음에 드는 상품 보이면 → 클릭!

**허용되는 행동:**
- ✅ 콜 리스트 화면 계속 확인
- ✅ 5초마다 새로고침 버튼 클릭
- ✅ 조건 맞는 콜 찾으면 클릭
- ✅ 금액/키워드/시간 체크

**절대 하면 안 되는 행동:**
- ❌ 수락 버튼 누르기 (아직 상세 화면이 아님)
- ❌ 확인 버튼 누르기

---

### 상태 3: DETECTED_CALL (콜 발견!)
```
상황: 콜 아이템을 클릭해서 "콜 상세 화면" 로드됨

관리자: "1단계 클릭 담당! 수락 버튼 찾아서 눌러!"

1단계 담당(DetectedCallHandler):
    [화면 스캔 중...]
    "있다! 'btn_call_accept' 버튼!"
    [클릭!]
    "관리자님, 클릭 성공했습니다!"

관리자: "좋아! 상태 변경: WAITING_FOR_CONFIRM으로!"
```

**비유:**
- 쇼핑몰에서 상품 클릭했더니 "상세 페이지" 열림
- 이제 "장바구니 담기" 버튼 찾아서 클릭하는 중

**허용되는 행동:**
- ✅ 수락 버튼 찾기
- ✅ 버튼 클릭하기

**절대 하면 안 되는 행동:**
- ❌ 다시 콜 리스트 화면으로 돌아가기
- ❌ 새로고침 버튼 누르기

---

### 상태 4: WAITING_FOR_CONFIRM (확인 기다림)
```
상황: 수락 버튼 눌렀더니 "정말 수락하시겠습니까?" 팝업 뜸

관리자: "2단계 확인 담당! 확인 버튼 눌러!"

2단계 담당(WaitingForConfirmHandler):
    [다이얼로그 스캔 중...]
    "확인 버튼 발견! 'btn_positive'!"
    [초고속 클릭! (10ms 간격으로 계속 시도)]

관리자: "클릭 성공! 상태 변경: CALL_ACCEPTED!"
```

**비유:**
- 온라인 쇼핑에서 "결제하기" 눌렀더니
- "정말 구매하시겠습니까?" 확인창 뜸
- 최대한 빨리 "확인" 버튼 눌러야 함 (다른 사람이 먼저 살 수도 있음!)

**허용되는 행동:**
- ✅ 확인 버튼 찾기
- ✅ 초고속으로 클릭 시도 (10ms마다!)

**절대 하면 안 되는 행동:**
- ❌ 수락 버튼 다시 누르기
- ❌ 뒤로 가기

---

### 상태 5: CALL_ACCEPTED (성공!)
```
상황: 확인 버튼까지 눌러서 콜 수락 완료!

관리자: "성공! 모두 수고했어!"
        [로봇 정지]
        [성공 로그 전송]

로봇: "이제 기사님이 손님 태우러 가시면 됩니다!"
```

**비유:**
- 온라인 쇼핑 결제 완료!
- "주문이 접수되었습니다" 화면
- 이제 배송 기다리면 됨 (자동화 종료)

**허용되는 행동:**
- ✅ 성공 메시지 표시
- ✅ 로그 전송
- ✅ 가만히 있기

**절대 하면 안 되는 행동:**
- ❌ 다시 콜 찾기 (한 번 성공하면 끝!)
- ❌ 자동으로 재시작

---

### 상태 6-8: 에러 상태들
```
ERROR_TIMEOUT (시간 초과):
    "10초 동안 버튼 못 찾았어... 포기"
    비유: 쇼핑몰 페이지가 10초 동안 안 열려서 포기

ERROR_ASSIGNED (이미 배차됨):
    "아, 다른 기사가 먼저 가져갔네"
    비유: 장바구니에 담으려는데 "품절" 뜸

ERROR_UNKNOWN (알 수 없는 오류):
    "뭔가 이상해... 버튼이 안 눌려"
    비유: 결제 버튼이 왜인지 작동 안 함
```

---

## 4. 상태 흐름: 일상 스토리

### 정상 시나리오 (Happy Path)
```
[아침 7시]
당신: "오늘 콜 받기 시작!" (시작 버튼 클릭)
    ↓
상태: IDLE → WAITING_FOR_CALL
로봇: "알겠습니다! 지금부터 콜 찾겠습니다!"

[7시 00분 ~ 7시 05분]
로봇: [화면 계속 확인 중...]
      [5초마다 새로고침 클릭]
      "아직 좋은 콜 없네..."

[7시 05분 30초]
로봇: "오! 15,000원짜리 인천공항 콜 발견!"
      [콜 아이템 클릭]
    ↓
상태: WAITING_FOR_CALL → DETECTED_CALL

[7시 05분 31초]
로봇: "수락 버튼 찾았다!"
      [수락 버튼 클릭]
    ↓
상태: DETECTED_CALL → WAITING_FOR_CONFIRM

[7시 05분 32초]
로봇: "확인 버튼 나타났다!"
      [확인 버튼 초고속 클릭]
    ↓
상태: WAITING_FOR_CONFIRM → CALL_ACCEPTED

[7시 05분 33초]
로봇: "완료! 콜 수락 성공!"
당신: "오케이! 손님 태우러 출발!"
```

**걸린 시간:** 약 3초 (콜 발견 → 최종 수락)

---

### 타임아웃 시나리오
```
[아침 7시]
당신: "콜 받기 시작!"
    ↓
상태: IDLE → WAITING_FOR_CALL

[7시 00분 ~ 7시 00분 10초]
로봇: [화면 확인 중...]
      "조건 맞는 콜이 하나도 없네..."
      "10초 지났다... 시간 초과!"
    ↓
상태: WAITING_FOR_CALL → ERROR_TIMEOUT

로봇: "관리자님, 10초 동안 조건 맞는 콜이 없었습니다."
당신: "알겠어, 다시 시작해볼게" (재시작 버튼 클릭)
```

---

## 5. 현재 코드의 문제: 비유로 설명

### 5.1 문제 상황: "일 안 하는 전문가"

**설계 의도:**
```
관리자: "스카우터야, 콜 리스트 화면 보고 좋은 콜 찾아!"
스카우터(CallListHandler): "네! 열심히 찾겠습니다!"
```

**실제 상황:**
```
관리자: "잠깐, 내가 직접 할게"
        [직접 새로고침 버튼 클릭]
        [5초 대기]
        [또 새로고침 버튼 클릭]
        [5초 대기]
        [무한 반복...]

스카우터: "...저 언제 일해요?"
관리자: "조용히 해! 바쁘다!"

스카우터: (하루 종일 대기실에서 빈둥빈둥)
```

**결과:**
- 관리자가 **전문가를 고용해놓고 안 씀**
- 스카우터(CallListHandler)는 코드만 있고 **절대 실행 안 됨**
- 시스템이 "새로고침 버튼만 누르는 로봇"으로 전락

---

### 5.2 비유: "식당 주방장과 웨이터"

**원래 역할 분담:**
```
주방장(엔진): "언제 요리할지 타이밍 결정"
웨이터(핸들러): "손님 주문 받고, 요리하고, 서빙하기"
```

**현재 상황:**
```
손님: "여기요, 주문이요!"

주방장: "잠깐! 내가 직접 할게!"
        [주방장이 직접 테이블로 나감]
        [메뉴판만 주고 돌아옴]
        "5분 후에 다시 올게요"

웨이터: "...저는요?"
주방장: "넌 그냥 서 있어"

[5분 후]
주방장: [또 테이블로 나감]
        [메뉴판만 주고 돌아옴]
        "5분 후에 다시 올게요"

손님: "언제 주문 받아요???"
웨이터: (하루 종일 벽만 봄)
```

**문제:**
- 주방장이 **타이밍 관리** + **실제 서빙**까지 다 하려고 함
- 웨이터는 **고용되어 있지만 일 안 함**
- 손님은 **주문조차 못함**

---

### 5.3 비유: "공장 컨베이어 벨트"

**정상 작동:**
```
[컨베이어 벨트]
원료 투입 → [작업자 A] → [작업자 B] → [작업자 C] → 완성품

각 작업자가 자기 역할 수행
```

**현재 상황:**
```
[컨베이어 벨트]
원료 투입 → [작업자 A 자리]
                    ↓
                [벨트 멈춤!]
                    ↓
            관리자가 직접 원료 확인
                    ↓
            "아직 때가 아니야"
                    ↓
            [원료 다시 시작점으로]
                    ↓
            5초 대기
                    ↓
            [무한 반복]

작업자 B, C: "우리 언제 일해요?"
```

**문제:**
- 컨베이어 벨트가 **작업자 A에서 항상 멈춤**
- 관리자가 직접 원료 검사하고 되돌림
- 작업자 B, C는 **절대 실행 안 됨**

---

## 6. Early Return의 문제: 비유

### 6.1 "문 앞에서 돌려보내기"

**정상 회사:**
```
방문객: "안녕하세요, 계약 건으로 왔습니다"
접수처: "네, 2층 계약팀으로 가세요"
    ↓
계약팀: [업무 처리]
    ↓
접수처: "처리 완료되셨나요?"
방문객: "네, 감사합니다"
```

**현재 코드:**
```
방문객: "안녕하세요, 콜 리스트 확인 왔습니다"
접수처: "잠깐! 지금 새로고침 시간이네?"
        [직접 새로고침 버튼 클릭]
        "네, 끝났어요. 돌아가세요"
    ↓
방문객: "어? 저는 콜 리스트를..."
접수처: "5초 후에 다시 오세요"

방문객(CallListHandler): (계속 문 앞에서 되돌아감)
계약팀(파싱 로직): (하루 종일 텅 빈 사무실)
```

**Early Return의 역할:**
- `return 30L` = "5초 후에 다시 오세요" (문전박대)
- 방문객이 **절대 사무실에 도착 못함**

---

### 6.2 "도서관 사서와 책 검색"

**정상 도서관:**
```
당신: "경제학 책 찾아주세요"
사서: "잠시만요" [서가 검색] "여기 있습니다"
```

**현재 코드:**
```
당신: "좋은 콜 찾아주세요"
관리자: "잠깐, 먼저 새 책 들어왔는지 확인할게"
        [신간 코너 확인]
        "새 책 없네. 5분 후에 다시 확인할게"
    ↓
당신: "제가 찾는 건 기존 책인데요..."
관리자: "조용히! 5분 후에!"

사서(CallListHandler): (하루 종일 휴게실에서 커피만 마심)
```

---

## 7. 해결 방법: 비유로 설명

### 옵션 1: "전문가에게 도구 주기"

**변경 전:**
```
관리자: [직접 새로고침 클릭]
        "끝! 돌아가!"
```

**변경 후:**
```
관리자: "스카우터야, 여기 새로고침 버튼 있어"
        "네가 필요할 때 직접 눌러"

스카우터: "알겠습니다!"
          [타이밍 보고 새로고침]
          [콜 리스트 파싱]
          [조건 맞는 콜 클릭]
          "관리자님, 좋은 콜 찾았습니다!"
```

**효과:**
- 관리자는 **타이밍만 관리**
- 스카우터가 **실제 일 수행**
- 역할 분담 명확

---

### 옵션 2: "새로고침을 별도 직원으로"

**변경 전:**
```
WAITING_FOR_CALL 상태
    ↓
관리자가 직접 새로고침
    ↓
돌아가!
```

**변경 후:**
```
WAITING_FOR_CALL 상태
    ↓
REFRESHING 상태 (새로고침 전용 직원)
    ↓
다시 WAITING_FOR_CALL
    ↓
스카우터가 콜 탐색
    ↓
DETECTED_CALL
```

**효과:**
- 새로고침이 **독립된 작업**으로 분리
- 각 직원이 **명확한 역할**

---

### 옵션 3: "관리자는 배정만"

**변경 전:**
```
관리자: [직접 새로고침]
        "끝! 5초 후에 다시!"
        (Early Return)
```

**변경 후:**
```
관리자: "스카우터야, 화면 봐봐"
스카우터: [새로고침 타이밍 확인]
          [필요 시 새로고침]
          [콜 리스트 파싱]
          "관리자님, 완료했습니다"
관리자: "좋아, 다음 작업 예약"
```

**효과:**
- 관리자는 **작업 배정만**
- 전문가가 **모든 로직 처리**

---

## 8. 상태 전이: 사람의 일과로 비유

### 아침 (시작)
```
7:00 AM - 일어남 (IDLE → WAITING_FOR_CALL)
         "오늘도 열심히 콜 받자!"
```

### 오전 (대기)
```
7:00-7:30 - 콜 리스트 화면 보면서 대기
            5분마다 새로고침
            "아직 좋은 콜 없네..."
```

### 정오 (발견!)
```
12:00 - "오! 15,000원짜리 인천공항 콜!"
        (WAITING_FOR_CALL → DETECTED_CALL)
        [콜 아이템 클릭]
```

### 오후 (수락)
```
12:01 - "수락 버튼 눌렀어!"
        (DETECTED_CALL → WAITING_FOR_CONFIRM)

12:02 - "확인 버튼도 눌렀어!"
        (WAITING_FOR_CONFIRM → CALL_ACCEPTED)
```

### 저녁 (완료)
```
18:00 - 손님 목적지 도착
        "오늘 일 끝! 집 가자"
        (CALL_ACCEPTED → IDLE)
```

---

## 9. 타임라인: "하루의 일과"로 설명

```
┌─────────────────────────────────────────────┐
│             로봇의 하루 (정상 시나리오)        │
└─────────────────────────────────────────────┘

07:00:00 - [잠에서 깸] (IDLE → WAITING_FOR_CALL)
           "좋아, 일 시작!"

07:00:00 - [화면 확인 시작]
           "콜 리스트 화면 보는 중..."

07:00:05 - [새로고침 타이머 울림]
           "새로고침 버튼 클릭!"

07:00:10 - [새로고침 타이머 울림]
           "또 새로고침!"

07:00:15 - [새로고침 타이머 울림]
           "또 새로고침!"

07:00:18 - [좋은 콜 발견!]
           "15,000원짜리 인천공항 콜 발견!"
           [콜 클릭]
           (WAITING_FOR_CALL → DETECTED_CALL)

07:00:19 - [수락 버튼 찾기]
           "수락 버튼 있다!"
           [클릭!]
           (DETECTED_CALL → WAITING_FOR_CONFIRM)

07:00:20 - [확인 버튼 찾기]
           "확인 버튼 나타남!"
           [초고속 클릭!]
           (WAITING_FOR_CONFIRM → CALL_ACCEPTED)

07:00:21 - [성공!]
           "콜 수락 완료! 손님 태우러 출발!"
           [로봇 정지]
```

**총 소요 시간:** 21초 (시작 → 성공)
**실제 작업 시간:** 3초 (콜 발견 → 최종 수락)

---

## 10. 핵심 정리: 5세 아이에게 설명하기

**질문:** "이 로봇은 뭐 하는 거야?"

**답변:**
```
이 로봇은 택시 기사 아저씨를 도와주는 친구야.

택시 앱에 손님 태우러 가는 "콜"이라는 게 뜨거든.
근데 아저씨가 직접 계속 화면 보고 버튼 누르기 힘들잖아?

그래서 로봇이 대신 해줘:
1. 화면 계속 보기
2. 좋은 콜 나오면 클릭하기
3. 확인 버튼까지 눌러주기

근데 지금 로봇이 좀 이상해.
새로고침 버튼만 계속 누르고,
정작 콜 찾는 건 안 해.

마치 엄마가 청소 로봇 샀는데,
그 로봇이 방 청소는 안 하고
현관 문만 계속 여닫고 있는 것 같아.

그래서 고쳐야 해!
```

---

**최종 요약:**

| 개념 | 비유 |
|------|------|
| 엔진 | 공장 관리자 (일정 관리) |
| 핸들러 | 전문가 팀 (실제 작업) |
| 상태 | 전광판 (현재 뭐 하는지) |
| 상태 전이 | 다음 작업으로 넘어가기 |
| Early Return | 문 앞에서 돌려보내기 |
| 현재 문제 | 관리자가 전문가 일 대신 하고 전문가는 놀고 있음 |

**해결책:**
"관리자는 스케줄만, 전문가는 실제 일!"
